<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de tareas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

    <style>

        body{
            background-image: url('img/mountain.jpg');
        }

    </style>

<body class="bg-light">
    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">Mi Lista de Tareas</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="tarea" placeholder="Añadir tarea...">
                            <button class="btn btn-primary" type="button" id="agregarBtn">Añadir</button>
                        </div>

                        <ul class="list-group mb-3" id="lista">
                            <li class="list-group-item text-muted text-center">No hay tareas</li>
                        </ul>

                        <div class="btn-group w-100">
                            <button class="btn btn-warning btn-sm" id="borrarCompletadas">Borrar completadas</button>
                            <button class="btn btn-danger btn-sm" id="borrarTodo">Borrar todo</button>
                        </div>

                        <hr>

                        <small class="text-muted">
                            Si abres esta página en otra pestaña, los cambios se sincronizarán automáticamente.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const input = document.getElementById('tarea');
        const agregarBtn = document.getElementById('agregarBtn');
        const lista = document.getElementById('lista');
        const borrarCompletadas = document.getElementById('borrarCompletadas');
        const borrarTodo = document.getElementById('borrarTodo');

        let tareas = [];

        function cargarTareas() {
            const txt = localStorage.getItem('mistareas');
            tareas = txt ? JSON.parse(txt) : [];
        }

        function guardarTareas() {
            localStorage.setItem('mistareas', JSON.stringify(tareas));
        }

        function mostrarTareas() {
            lista.innerHTML = '';

            if (tareas.length === 0) {
                lista.innerHTML = '<li class="list-group-item text-muted text-center">No hay tareas</li>';
                return;
            }

            tareas.forEach((t, idx) => {
                const li = document.createElement('li');
                li.className = `list-group-item d-flex justify-content-between align-items-center ${t.done ? 'list-group-item-success' : ''}`;
                
                li.innerHTML = `
                    <div style="cursor: pointer; flex: 1;">
                        <input type="checkbox" class="form-check-input me-2" ${t.done ? 'checked' : ''}>
                        <span style="text-decoration: ${t.done ? 'line-through' : 'none'}">${t.texto}</span>
                    </div>
                    <button class="btn btn-sm btn-outline-danger">✕</button>
                `;

                const checkbox = li.querySelector('input');
                const btnBorrar = li.querySelector('button');

                checkbox.addEventListener('change', () => {
                    tareas[idx].done = checkbox.checked;
                    guardarTareas();
                    mostrarTareas();
                });

                btnBorrar.addEventListener('click', () => {
                    tareas.splice(idx, 1);
                    guardarTareas();
                    mostrarTareas();
                });

                lista.appendChild(li);
            });
        }

        agregarBtn.addEventListener('click', () => {
            const txt = input.value.trim();
            if (txt) {
                tareas.push({ texto: txt, done: false });
                guardarTareas();
                mostrarTareas();
                input.value = '';
            }
        });

        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') agregarBtn.click();
        });

        borrarCompletadas.addEventListener('click', () => {
            tareas = tareas.filter(t => !t.done);
            guardarTareas();
            mostrarTareas();
        });

        borrarTodo.addEventListener('click', () => {
            if (confirm('¿Borrar todas?')) {
                tareas = [];
                localStorage.removeItem('mistareas');
                mostrarTareas();
            }
        });

        // Sincronizar con otras pestañas
        window.addEventListener('storage', (e) => {
            if (e.key === 'mistareas') {
                cargarTareas();
                mostrarTareas();
            }
        });

        cargarTareas();
        mostrarTareas();
    </script>
</body>
</html>
